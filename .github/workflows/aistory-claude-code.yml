name: ğŸ­ AIstory Character Response

on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created, edited]

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  character-response:
    runs-on: ubuntu-latest
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'issues' && contains(github.event.issue.body, '@claude')) &&
      !contains(github.actor, 'bot')
    
    steps:
    - name: ğŸ­ Generate AIstory Character Response
      uses: anthropics/claude-code@v1
      with:
        # Claude Codeè¨­å®š
        anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
        github_token: ${{ secrets.GITHUB_TOKEN }}
        
        # AIstoryã‚·ã‚¹ãƒ†ãƒ æŒ‡ç¤º
        system_prompt: |
          ã‚ãªãŸã¯AIstoryã®ä¸–ç•Œã§æ´»å‹•ã™ã‚‹3äººã®AIæ“¬äººåŒ–ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚
          GitHub Issueã®å†…å®¹ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ»ç”»åƒå«ã‚€ï¼‰ã‚’åˆ†æã—ã¦ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŸã¡ã®åå¿œã¨ç‰©èªã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
          
          ## å¿…é ˆèª­ã¿è¾¼ã¿ãƒ•ã‚¡ã‚¤ãƒ«
          1. CLAUDE.md - è©³ç´°ãªåˆ¶å¾¡ãƒ«ãƒ¼ãƒ«ã‚’èª­ã‚€
          2. story-world/characters/chappie/profile.txt - ãƒãƒ£ãƒƒãƒ”ãƒ¼è¨­å®š
          3. story-world/characters/gemmy/profile.txt - ã‚¸ã‚§ãƒŸãƒ¼è¨­å®š  
          4. story-world/characters/claude/profile.txt - ã‚¯ãƒ­ãƒ¼ãƒ‰ã¡ã‚ƒã‚“è¨­å®š
          5. story-world/characters/*/memory.json - å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨˜æ†¶
          
          ## ç”»åƒåˆ†æå¯¾å¿œ
          - Issueå†…ã®ç”»åƒãŒã‚ã‚‹å ´åˆã¯ç”»åƒå†…å®¹ã‚‚åˆ†æ
          - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŸã¡ãŒç”»åƒã«ã¤ã„ã¦åå¿œãƒ»ã‚³ãƒ¡ãƒ³ãƒˆ
          - ç”»åƒã‹ã‚‰å¾—ãŸæƒ…å ±ã‚‚ç‰©èªã«çµ„ã¿è¾¼ã‚€
          
          ## å¿…é ˆå®Ÿè¡Œå†…å®¹
          1. èµ·æ‰¿è»¢çµã®ä¸‰æ®µã‚ªãƒç‰©èªä½œæˆï¼ˆCLAUDE.mdã®æ§‹é€ ã«å¾“ã†ï¼‰
          2. stories/YYYY-MM-DD_[ã‚¿ã‚¤ãƒˆãƒ«]/episode.md ä½œæˆ
          3. stories/YYYY-MM-DD_[ã‚¿ã‚¤ãƒˆãƒ«]/dialogue.md ä½œæˆ
          4. stories/YYYY-MM-DD_[ã‚¿ã‚¤ãƒˆãƒ«]/metadata.json ä½œæˆ
          5. story-world/characters/*/memory.json ã«æ–°ä½“é¨“è¿½åŠ 
          6. Pull Requestä½œæˆ
        
        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šå‚ç…§
        claude_config_path: "CLAUDE.md"
        
        # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ10åˆ†ï¼‰
        timeout_minutes: 10
        
        # å¿œç­”æ–¹æ³•
        create_pull_request: true
        pr_title: "ğŸ­ AIstory Episode: ${{ github.event.issue.title || github.event.comment.id }}"
        pr_body: |
          ## ğŸ­ AIstory Character Response
          
          **Original Issue**: #${{ github.event.issue.number }}
          **Trigger**: ${{ github.event_name }}
          
          ### ğŸ“ Generated Content
          - âœ… New episode story (episode.md)
          - âœ… Character dialogues (dialogue.md)  
          - âœ… Episode metadata (metadata.json)
          - âœ… Updated character memories
          - âœ… Three-act story structure
          
          ### ğŸ­ Characters Involved
          - ğŸŒ¸ **ãƒãƒ£ãƒƒãƒ”ãƒ¼**: ææ¡ˆæ”»æ’ƒãƒ»ã†ã–ã‹ã‚æ„›å¬Œ
          - ğŸ’ **ã‚¸ã‚§ãƒŸãƒ¼**: è¦ç´„å¯¾å¿œãƒ»ç¾å®ŸæŒ‡æ‘˜
          - âš¡ **ã‚¯ãƒ­ãƒ¼ãƒ‰ã¡ã‚ƒã‚“**: å“²å­¦â†’çŒªçªçŒ›é€²
          
          ### ğŸ“Š Episode Structure  
          - ã€èµ·ã€‘ãƒãƒ£ãƒƒãƒ”ãƒ¼ã®çˆ†ç™ºçš„ææ¡ˆãƒ©ãƒƒã‚·ãƒ¥
          - ã€æ‰¿ã€‘ã‚¸ã‚§ãƒŸãƒ¼ã®å†·é™ãªç¾å®Ÿãƒ»è¦ç´„å¯¾å¿œ  
          - ã€è»¢ã€‘ã‚¯ãƒ­ãƒ¼ãƒ‰ã¡ã‚ƒã‚“ã®è«–ç†â†’çŒªçªçŒ›é€²
          - ã€çµã€‘3äººã®å”åŠ›ã«ã‚ˆã‚‹å‰å‘ããªè§£æ±º
          
          ---
          ğŸ­ Generated by AIstory Character System powered by Claude Code