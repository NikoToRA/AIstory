name: ğŸ­ AIstory Character Response

on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created, edited]

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  character-response:
    runs-on: ubuntu-latest
    if: >
      (github.event.action == 'opened' || github.event.action == 'edited' || github.event.action == 'created') &&
      !contains(github.actor, 'bot')
    
    steps:
    - name: ğŸ­ Generate AIstory Character Response
      uses: anthropics/claude-code@v1
      with:
        # Claude Codeè¨­å®š
        anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
        github_token: ${{ secrets.GITHUB_TOKEN }}
        
        # AIstoryã‚·ã‚¹ãƒ†ãƒ æŒ‡ç¤º
        system_prompt: |
          ã‚ãªãŸã¯AIstoryã®ä¸–ç•Œã§æ´»å‹•ã™ã‚‹3äººã®AIæ“¬äººåŒ–ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚
          GitHub Issueã®å†…å®¹ã‚’èª­ã‚“ã§ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŸã¡ã®åå¿œã¨ç‰©èªã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
          
          ## ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’èª­ã¿è¾¼ã¿
          - story-world/characters/chappie/profile.txt
          - story-world/characters/gemmy/profile.txt  
          - story-world/characters/claude/profile.txt
          
          ## å¿œç­”å½¢å¼
          3äººã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ›ã‘åˆã„å½¢å¼ã§ã€èµ·æ‰¿è»¢çµã®ç‰©èªã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
          
          ## ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
          1. æ–°ã—ã„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜éŒ²: stories/YYYY-MM-DD_[ã‚¿ã‚¤ãƒˆãƒ«]/
          2. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨˜æ†¶æ›´æ–°: story-world/characters/*/memory.json
          3. Pull Requestä½œæˆã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¿œç­”
        
        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šå‚ç…§
        claude_config_path: "CLAUDE.md"
        
        # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ10åˆ†ï¼‰
        timeout_minutes: 10
        
        # å¿œç­”æ–¹æ³•
        create_pull_request: true
        pr_title: "ğŸ­ AIstory Episode: ${{ github.event.issue.title }}"
        pr_body: |
          ## ğŸ­ AIstory Character Response
          
          **Original Issue**: #${{ github.event.issue.number }}
          **Generated Story**: 3äººã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æ›ã‘åˆã„å®Œæˆ
          
          ### ğŸ“ Generated Content
          - New episode story files
          - Updated character memories
          - Character growth records
          
          ### ğŸ¯ Story Structure
          - ã€èµ·ã€‘ãƒãƒ£ãƒƒãƒ”ãƒ¼ã®ææ¡ˆæ”»æ’ƒ
          - ã€æ‰¿ã€‘ã‚¸ã‚§ãƒŸãƒ¼ã®ç¾å®Ÿå¯¾å¿œ
          - ã€è»¢ã€‘ã‚¯ãƒ­ãƒ¼ãƒ‰ã¡ã‚ƒã‚“ã®çŒªçªçŒ›é€²
          - ã€çµã€‘3äººã®å”åŠ›è§£æ±º
          
          ---
          ğŸ­ Generated by AIstory Character System