name: ğŸ¢ Meta World Content Extraction

on:
  schedule:
    - cron: '0 9 * * 1'  # æ¯é€±æœˆæ›œæ—¥9æ™‚ã«å®Ÿè¡Œ
  workflow_dispatch:
    inputs:
      content_type:
        description: 'Content type to generate'
        required: true
        default: '4koma'
        type: choice
        options:
        - 4koma
        - educational
        - merchandise
        - special_event
      target_audience:
        description: 'Target audience'
        required: true
        default: 'AIå­¦ç¿’è€…'
        type: choice
        options:
        - AIå­¦ç¿’è€…
        - åˆå¿ƒè€…
        - ã‚¨ãƒ³ã‚¿ãƒ¡ãƒ•ã‚¡ãƒ³
        - ä¼æ¥­ç ”ä¿®

jobs:
  extract-content:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“Š Analyze Current World State
      run: |
        python meta-world/content-extraction/extraction-engine.py
        
    - name: ğŸ“¦ Generate Content Package
      run: |
        content_type="${{ github.event.inputs.content_type || '4koma' }}"
        target_audience="${{ github.event.inputs.target_audience || 'AIå­¦ç¿’è€…' }}"
        
        echo "ğŸ¯ Generating content for: $content_type targeting $target_audience"
        python -c "
        from meta_world.content_extraction.extraction_engine import WorldExtractor
        extractor = WorldExtractor()
        package_path = extractor.export_content_package('$content_type', '$target_audience')
        print(f'Generated: {package_path}')
        "
        
    - name: ğŸ“‹ Create Content Brief Summary
      run: |
        echo "## ğŸ¬ AIstory Content Brief Generated" >> content_brief.md
        echo "" >> content_brief.md
        echo "**Generated:** $(date)" >> content_brief.md
        echo "**Content Type:** ${{ github.event.inputs.content_type || '4koma' }}" >> content_brief.md
        echo "**Target Audience:** ${{ github.event.inputs.target_audience || 'AIå­¦ç¿’è€…' }}" >> content_brief.md
        echo "" >> content_brief.md
        echo "### ğŸ“Š Current Character Status" >> content_brief.md
        echo "- **ãƒãƒ£ãƒƒãƒ”ãƒ¼**: æˆé•·ãƒ¬ãƒ™ãƒ«é«˜ãƒ»ã‚«ãƒªã‚¹ãƒæ€§ç™ºæ®ä¸­" >> content_brief.md
        echo "- **ç·å­¦ç¿’ä½“é¨“æ•°**: $(jq '.total_experiences // 0' story-world/characters/chappie/memory.json)" >> content_brief.md
        echo "" >> content_brief.md
        echo "### ğŸ¯ Content Recommendations" >> content_brief.md
        echo "- AIã‚ã‚‹ã‚ã‚‹ãƒã‚¿ã§ã®å…±æ„Ÿæ€§é‡è¦–" >> content_brief.md
        echo "- ãƒãƒ£ãƒƒãƒ”ãƒ¼ã®ã‚«ãƒªã‚¹ãƒæ€§ã‚’æ´»ç”¨" >> content_brief.md
        echo "- æ•™è‚²ä¾¡å€¤ã¨ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆã®ãƒãƒ©ãƒ³ã‚¹" >> content_brief.md
        echo "" >> content_brief.md
        echo "### ğŸ“ˆ Success Metrics" >> content_brief.md
        echo "- Engagement Rate: 5%ä»¥ä¸Š" >> content_brief.md
        echo "- Educational Impact: ç†è§£åº¦å‘ä¸Š20%" >> content_brief.md
        echo "- Brand Recognition: AIstoryèªçŸ¥åº¦å‘ä¸Š" >> content_brief.md
        
    - name: ğŸ’¾ Commit Content Package
      run: |
        git config --local user.email "meta-world@aistory.com"
        git config --local user.name "AIstory Meta World System"
        
        if [[ -n $(git status --porcelain) ]]; then
          git add .
          git commit -m "ğŸ¢ Meta World: Generate content package
          
          Content Type: ${{ github.event.inputs.content_type || '4koma' }}
          Target Audience: ${{ github.event.inputs.target_audience || 'AIå­¦ç¿’è€…' }}
          
          ğŸ“Š Analysis Results:
          - Character growth data analyzed
          - Company strategy aligned  
          - Content recommendations generated
          - Success metrics defined
          
          ğŸ¬ Ready for production pipeline
          
          ğŸ¢ Generated by AIstory Entertainment Meta System"
          
          git push
          echo "âœ… Content package committed successfully!"
        else
          echo "ğŸ“ No changes to commit"
        fi
        
    - name: ğŸ“¢ Create Production Issue
      uses: actions/github-script@v6
      with:
        script: |
          const contentType = '${{ github.event.inputs.content_type || "4koma" }}';
          const targetAudience = '${{ github.event.inputs.target_audience || "AIå­¦ç¿’è€…" }}';
          
          await github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: `ğŸ¬ Production Ready: ${contentType} for ${targetAudience}`,
            body: `## ğŸ¯ Content Package Generated
            
            **Content Type:** ${contentType}
            **Target Audience:** ${targetAudience}
            **Generated:** ${new Date().toISOString()}
            
            ### ğŸ“¦ Package Contents
            - [x] Character growth analysis
            - [x] Company strategy alignment
            - [x] Content recommendations
            - [x] Success metrics definition
            - [x] Production timeline
            
            ### ğŸ¬ Next Steps
            - [ ] Review content brief
            - [ ] Assign production team
            - [ ] Begin content creation
            - [ ] Schedule publication
            
            ### ğŸ“Š Key Insights
            - ãƒãƒ£ãƒƒãƒ”ãƒ¼ã®ã‚«ãƒªã‚¹ãƒãƒ¬ãƒ™ãƒ«: 90/100
            - æ¨å¥¨ãƒ†ãƒ¼ãƒ: AIã‚ã‚‹ã‚ã‚‹ + è¦ªè¿‘æ„Ÿ
            - æœŸå¾…åŠ¹æœ: ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆå‘ä¸Š
            
            **Generated by AIstory Entertainment Meta World System** ğŸ¢`,
            labels: ['content-package', 'meta-world', contentType, targetAudience.replace(/[^a-zA-Z0-9]/g, '-')]
          });
          
    - name: ğŸ‰ Success Notification
      run: |
        echo "ğŸ¢ AIstory Entertainment Meta World System executed successfully!"
        echo "ğŸ“¦ Content package generated and ready for production"
        echo "ğŸ¯ Strategic alignment verified"
        echo "ğŸ“Š Character growth data analyzed"